## 编译
### 什么是编译
- 编译是一种转化过程，在未指明上下文时，在java中，既可以指前端编译，又可以指后端编译

### 编译的分类
- 前端编译：一个前端编译器把java文件转变成class文件
	- 常用编译器：JDK的javac
- 即时编译：即时编译器运行期把字节码转变成本地机器码
	- HotSpot虚拟机的C1、C2编译器
- 提前编译：直接把程序编译成与目标机器指令集相关的二进制代码

这里我们把前端编译作为编译这一词的指代

### javac编译器
- javac编译器本身由java编写。

### 编译过程
1. 准备过程：初始化插入式注解处理器
2. 解析与填充符号表
3. 注解处理
4. 分析与字节码生成
![[截屏2021-11-16 上午8.39.49.png]]
#### 解析与填充符号表
##### 词法分析、语法分析
- 词法分析：将源代码里的字符流转表成标记，如`int a=b+2`就有6个标记，标记就是各种符合条件的”单词“
- 语法分析：根据标记序列构造抽象语法树。
- 生成语法树后，后续操作不会对源码字符串进行处理，后续操作都是在抽象语法树的基础上。

##### 填充符号表
- 符号表：一组符号地址和符号信息构成的数据结构，可以类比哈希表键值对。

#### 注解处理
##### 插入式注解处理器
- 可以看成是编译器的插件，允许对抽象语法树进行读取、修改等操作。
- 如果处理注解期间对语法树进行修改，需要再次返回执行解析和填充符号表
- 如`Lombok`通过这个，就可以自动生成`getter setter`方法

#### 语义分析与字节码生成
##### 语义分析
- 主要是对结构上正确的源程序进行上下文相关性质的检查，如类型检查、控制流检查等。

###### 标注检查
- 检查变量使用前是否已被生命、变量与赋值之间的类型是否匹配等。
- 顺便进行一个优化--常量折叠。
	- 代码`a = 1+2`，编译器会直接存成`3`

###### 数据及控制流分析

##### 解语法糖
- 常见语法糖：泛型、变长参数、自动拆箱装箱等
- 虚拟机不支持这些语法，它们在编译阶段就被还原成原始的基础语法结构，称为解语法糖

##### 字节码生成
- 将前面步骤生成的信息（语法树、符号表）转化成字节码，生成最终的class文件。

### 语法糖


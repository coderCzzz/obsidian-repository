# 分区表
## 什么是分区表
- 分区表就是把大表按照不同的条件单独存放到不同的**物理小表**中，构建出完整的逻辑表
	- 例如将数据按照年份拆分出多个物理小表

## 分区表的优点
- 更少的数据检索范围
- 拆分超级大的表，将部分数据加载至内存
- 分区表的数据更容易维护
- 分区表数据可以分布在不同的硬盘上，并发IO
- 减少锁的范围，避免大表锁表
- 可独立备份，恢复分区数据

## MySQL分区表语法
```
PARTITION BY RANGE(字段名a)
(
PARTITION 分区1 VALUES 条件如less than(2014)
PARTITION 分区2 VALUES less than(2015)
)
```

## 分区表的使用限制
- 查询必须包含分区列，不允许对分区列进行计算
- 分区列必须是数字类型
- 分区表不支持建立外键索引
- 建表时主键必须包含所有的列
- 最多1024个分区

# 分库分表
- 分区表的替代技术

## 数据分库
- 将数据库拆分成多个库
	- 按照业务，如商品库、订单库、财务库
- 缺点
	- 数据分布不均匀，不能根本上解决海量数据存储问题

## 数据分表
- 将大表拆分到不同服务器的相同数据库的相同表
	- 如将商品表拆分到商品库1、2、3的商品表中。根据算法，将商品数据均匀的分布到这三台数据库

## 垂直拆分与水平拆分
- 垂直拆分
	- 垂直分表：将一张表将字段分段分开，把字段拆分成多个表
		- 好处：比如将课程表拆成基本表和描述表。只用该某一部分就行了
	- 垂直分库：把单一的数据库按照业务划分，做到专库专表
- 水平拆分
	- 水平分表：将一个数据库里的表拆分成多个相同的表，根据一定的规则判断写入哪个表
	- 水平分库：将一个数据库拆分成两个相同的数据库，写入时按照一定的规则判断写到哪一个。
- 应用
	- 设计阶段要考虑垂直分库、垂直分表
	- 数据量增大，出现问题，先考虑缓存、读写分离、使用索引等，然后再考虑垂直分库、垂直分表
- 问题
	- 跨节点连接查询（join）问题（分页、查询）--解决：先把需要的都查出来，再在代码里分页、排序
	- 多数据源管理

## 分库分表中间件
|      |支持分库|支持分表|中间层|开源|数据库支持|支持语言|更新频率|
|------|---------|---------|-------|----|-----------|---------|--------|
|MyCat|支持    |支持  |是   |是   |mysql |  任意    |暂停维护 |
|CoBar|支持    |不支持  |是   |是   |mysql |  任意    |停止维护 |
|TDDL|支持    |不支持  |否   |是   |任意    |  java    |暂停维护 |
|Sharding Sphere|支持 |支持  |否  |是   |任意 |  java    |活跃 |

